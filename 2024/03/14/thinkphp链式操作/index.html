<!DOCTYPE html><html lang="zh_CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>thinkphp链式操作 | 凯瑟兰森</title><meta name="author" content="凯瑟兰森"><meta name="copyright" content="凯瑟兰森"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="链式操作 数据库提供的链式操作方法，可以有效的提高数据存取的代码清晰度和开发效率，并且支持所有的CURD操作。 使用也比较简单，假如我们现在要查询一个User表的满足状态为1的前10条记录，并希望按照用户的创建时间排序 ，代码如下： 12345Db::table(&#x27;think_user&#x27;)    -&gt;where(&#x27;status&#x27;,1)    -&gt;">
<meta property="og:type" content="article">
<meta property="og:title" content="thinkphp链式操作">
<meta property="og:url" content="https://2486125878.github.io/2024/03/14/thinkphp%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C/index.html">
<meta property="og:site_name" content="凯瑟兰森">
<meta property="og:description" content="链式操作 数据库提供的链式操作方法，可以有效的提高数据存取的代码清晰度和开发效率，并且支持所有的CURD操作。 使用也比较简单，假如我们现在要查询一个User表的满足状态为1的前10条记录，并希望按照用户的创建时间排序 ，代码如下： 12345Db::table(&#x27;think_user&#x27;)    -&gt;where(&#x27;status&#x27;,1)    -&gt;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg">
<meta property="article:published_time" content="2024-03-14T03:18:02.000Z">
<meta property="article:modified_time" content="2024-03-14T03:46:06.000Z">
<meta property="article:author" content="凯瑟兰森">
<meta property="article:tag" content="php">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://2486125878.github.io/2024/03/14/thinkphp%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'thinkphp链式操作',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-14 11:46:06'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/header.css?1"><link rel="stylesheet" href="/css/custom.css?1"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="凯瑟兰森" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img0.baidu.com/it/u=571211534,249494121&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=800&amp;h=800"/><div class="loading-image-dot"></div><div id="loading-percentage">0%</div></div></div><script>const loadingPercentage = document.getElementById("loading-percentage");
loadingPercentage.style.color = "black";
let loadingPercentageTimer = setInterval(function() {
  var progressBar = document.querySelector(".pace-progress");
  if (!progressBar) return
  var currentValue = progressBar.getAttribute("data-progress-text");
  if (currentValue !== loadingPercentage.textContent) {
    loadingPercentage.textContent = currentValue;
    if (currentValue === "100%") {
      clearInterval(loadingPercentageTimer);
    }
  }
}, 100);
const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img0.baidu.com/it/u=571211534,249494121&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=800&amp;h=800" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="凯瑟兰森"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo.png"/><span class="site-name">凯瑟兰森</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">thinkphp链式操作</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-03-14T03:18:02.000Z" title="Created 2024-03-14 11:18:02">2024-03-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-03-14T03:46:06.000Z" title="Updated 2024-03-14 11:46:06">2024-03-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/thinkphp%E6%9F%A5%E8%AF%A2/">thinkphp查询</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="thinkphp链式操作"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"></svg><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="链式操作"><a href="#链式操作" class="headerlink" title="链式操作"></a>链式操作</h1><hr>
<p>数据库提供的链式操作方法，可以有效的提高数据存取的代码清晰度和开发效率，并且支持所有的CURD操作。</p>
<p>使用也比较简单，假如我们现在要查询一个User表的满足状态为1的前10条记录，并希望按照用户的创建时间排序 ，代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">order</span>(<span class="string">&#x27;create_time&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">limit</span>(<span class="number">10</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>这里的<code>where</code>、<code>order</code>和<code>limit</code>方法就被称之为链式操作方法，除了select方法必须放到最后一个外（因为select方法并不是链式操作方法），链式操作的方法调用顺序没有先后，例如，下面的代码和上面的等效：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">order</span>(<span class="string">&#x27;create_time&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">10</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status&#x27;</span>,<span class="number">1</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>其实不仅仅是查询方法可以使用连贯操作，包括所有的CURD方法都可以使用，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>,<span class="number">1</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;id,name,email&#x27;</span>)-&gt;<span class="title function_ invoke__">find</span>(); <span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status&#x27;</span>,<span class="number">1</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>,<span class="number">1</span>)-&gt;<span class="title function_ invoke__">delete</span>();</span><br></pre></td></tr></table></figure>

<p>链式操作在完成查询后会自动清空链式操作的所有传值。简而言之，链式操作的结果不会带入后面的其它查询。</p>
<p>系统支持的链式操作方法有：</p>
<table>
<thead>
<tr>
<th align="left">连贯操作</th>
<th align="left">作用</th>
<th align="left">支持的参数类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">where*</td>
<td align="left">用于AND查询</td>
<td align="left">字符串、数组和对象</td>
</tr>
<tr>
<td align="left">whereOr*</td>
<td align="left">用于OR查询</td>
<td align="left">字符串、数组和对象</td>
</tr>
<tr>
<td align="left">wheretime*</td>
<td align="left">用于时间日期的快捷查询</td>
<td align="left">字符串</td>
</tr>
<tr>
<td align="left">table</td>
<td align="left">用于定义要操作的数据表名称</td>
<td align="left">字符串和数组</td>
</tr>
<tr>
<td align="left">alias</td>
<td align="left">用于给当前数据表定义别名</td>
<td align="left">字符串</td>
</tr>
<tr>
<td align="left">field*</td>
<td align="left">用于定义要查询的字段（支持字段排除）</td>
<td align="left">字符串和数组</td>
</tr>
<tr>
<td align="left">order</td>
<td align="left">用于对结果排序</td>
<td align="left">字符串和数组</td>
</tr>
<tr>
<td align="left">limit</td>
<td align="left">用于限制查询结果数量</td>
<td align="left">字符串和数字</td>
</tr>
<tr>
<td align="left">page</td>
<td align="left">用于查询分页（内部会转换成limit）</td>
<td align="left">字符串和数字</td>
</tr>
<tr>
<td align="left">group</td>
<td align="left">用于对查询的group支持</td>
<td align="left">字符串</td>
</tr>
<tr>
<td align="left">having</td>
<td align="left">用于对查询的having支持</td>
<td align="left">字符串</td>
</tr>
<tr>
<td align="left">join*</td>
<td align="left">用于对查询的join支持</td>
<td align="left">字符串和数组</td>
</tr>
<tr>
<td align="left">union*</td>
<td align="left">用于对查询的union支持</td>
<td align="left">字符串、数组和对象</td>
</tr>
<tr>
<td align="left">view</td>
<td align="left">用于视图查询</td>
<td align="left">字符串、数组</td>
</tr>
<tr>
<td align="left">distinct</td>
<td align="left">用于查询的distinct支持</td>
<td align="left">布尔值</td>
</tr>
<tr>
<td align="left">lock</td>
<td align="left">用于数据库的锁机制</td>
<td align="left">布尔值</td>
</tr>
<tr>
<td align="left">cache</td>
<td align="left">用于查询缓存</td>
<td align="left">支持多个参数</td>
</tr>
<tr>
<td align="left">relation</td>
<td align="left">用于关联查询</td>
<td align="left">字符串</td>
</tr>
<tr>
<td align="left">with</td>
<td align="left">用于关联预载入</td>
<td align="left">字符串、数组</td>
</tr>
<tr>
<td align="left">bind*</td>
<td align="left">用于数据绑定操作</td>
<td align="left">数组或多个参数</td>
</tr>
<tr>
<td align="left">comment</td>
<td align="left">用于SQL注释</td>
<td align="left">字符串</td>
</tr>
<tr>
<td align="left">force</td>
<td align="left">用于数据集的强制索引</td>
<td align="left">字符串</td>
</tr>
<tr>
<td align="left">master</td>
<td align="left">用于设置主服务器读取数据</td>
<td align="left">布尔值</td>
</tr>
<tr>
<td align="left">strict</td>
<td align="left">用于设置是否严格检测字段名是否存在</td>
<td align="left">布尔值</td>
</tr>
<tr>
<td align="left">sequence</td>
<td align="left">用于设置Pgsql的自增序列名</td>
<td align="left">字符串</td>
</tr>
<tr>
<td align="left">failException</td>
<td align="left">用于设置没有查询到数据是否抛出异常</td>
<td align="left">布尔值</td>
</tr>
<tr>
<td align="left">partition</td>
<td align="left">用于设置分表信息</td>
<td align="left">数组 字符串</td>
</tr>
</tbody></table>
<blockquote>
<p>所有的连贯操作都返回当前的模型实例对象（this），其中带*标识的表示支持多次调用。</p>
</blockquote>
<h1 id="where"><a href="#where" class="headerlink" title="where"></a>where</h1><hr>
<p>where方法的用法是ThinkPHP查询语言的精髓，也是ThinkPHP ORM的重要组成部分和亮点所在，可以完成包括普通查询、表达式查询、快捷查询、区间查询、组合查询在内的查询操作。where方法的参数支持字符串和数组，虽然也可以使用对象但并不建议。</p>
<h2 id="表达式查询"><a href="#表达式查询" class="headerlink" title="表达式查询"></a>表达式查询</h2><p>新版的表达式查询采用全新的方式，查询表达式的使用格式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;&gt;&#x27;</span>,<span class="number">1</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;thinkphp&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>(); </span><br></pre></td></tr></table></figure>

<p>更多的表达式查询语法，可以参考查询语法部分。</p>
<h2 id="数组条件"><a href="#数组条件" class="headerlink" title="数组条件"></a>数组条件</h2><p>可以通过数组方式批量设置查询条件。</p>
<h3 id="普通查询"><a href="#普通查询" class="headerlink" title="普通查询"></a>普通查询</h3><p>最简单的数组查询方式如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$map</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&#x27;thinkphp&#x27;</span>;<span class="variable">$map</span>[<span class="string">&#x27;status&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 把查询条件传入查询方法</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$map</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>最后生成的SQL语句是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> think_user <span class="keyword">WHERE</span> `name`<span class="operator">=</span><span class="string">&#x27;thinkphp&#x27;</span> <span class="keyword">AND</span> status<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="表达式查询-1"><a href="#表达式查询-1" class="headerlink" title="表达式查询"></a>表达式查询</h3><p>可以在数组条件中使用查询表达式，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$map</span>[<span class="string">&#x27;id&#x27;</span>]=[<span class="string">&#x27;&gt;&#x27;</span>,<span class="number">1</span>];</span><br><span class="line"><span class="variable">$map</span>[<span class="string">&#x27;mail&#x27;</span>]=[<span class="string">&#x27;like&#x27;</span>,<span class="string">&#x27;%thinkphp@qq.com%&#x27;</span>];</span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$map</span>)-&gt;<span class="title function_ invoke__">select</span>(); </span><br></pre></td></tr></table></figure>

<h2 id="字符串条件"><a href="#字符串条件" class="headerlink" title="字符串条件"></a>字符串条件</h2><p>使用字符串条件直接查询和操作，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;type=1 AND status=1&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>(); </span><br></pre></td></tr></table></figure>

<p>最后生成的SQL语句是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> think_user <span class="keyword">WHERE</span> type<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> status<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>使用字符串条件的时候，建议配合预处理机制，确保更加安全，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&quot;id=:id and username=:name&quot;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">bind</span>([<span class="string">&#x27;id&#x27;</span>=&gt;[<span class="number">1</span>,\PDO::<span class="variable constant_">PARAM_INT</span>],<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;thinkphp&#x27;</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>



<h1 id="table"><a href="#table" class="headerlink" title="table"></a>table</h1><hr>
<p>table方法主要用于指定操作的数据表。</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>一般情况下，操作模型的时候系统能够自动识别当前对应的数据表，所以，使用table方法的情况通常是为了：</p>
<ol>
<li>切换操作的数据表；</li>
<li>对多表进行操作；</li>
</ol>
<p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status&gt;1&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>也可以在table方法中指定数据库，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;db_name.think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status&gt;1&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>table方法指定的数据表需要完整的表名，但可以采用下面的方式简化数据表前缀的传入，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;__USER__&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status&gt;1&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>会自动获取当前模型对应的数据表前缀来生成 <code>think_user</code> 数据表名称。</p>
<p>需要注意的是table方法不会改变数据库的连接，所以你要确保当前连接的用户有权限操作相应的数据库和数据表。 切换数据表后，系统会自动重新获取切换后的数据表的字段缓存信息。</p>
<p>如果需要对多表进行操作，可以这样使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">field</span>(<span class="string">&#x27;user.name,role.title&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user user,think_role role&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">limit</span>(<span class="number">10</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>为了尽量避免和mysql的关键字冲突，可以建议使用数组方式定义，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">field</span>(<span class="string">&#x27;user.name,role.title&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">table</span>([<span class="string">&#x27;think_user&#x27;</span>=&gt;<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;think_role&#x27;</span>=&gt;<span class="string">&#x27;role&#x27;</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">limit</span>(<span class="number">10</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>使用数组方式定义的优势是可以避免因为表名和关键字冲突而出错的情况。</p>
<h1 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h1><hr>
<p>alias用于设置当前数据表的别名，便于使用其他的连贯操作例如join方法等。</p>
<p>示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">alias</span>(<span class="string">&#x27;a&#x27;</span>)-&gt;<span class="title function_ invoke__">join</span>(<span class="string">&#x27;__DEPT__ b &#x27;</span>,<span class="string">&#x27;b.user_id= a.id&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>最终生成的SQL语句类似于：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> think_user a <span class="keyword">INNER</span> <span class="keyword">JOIN</span> think_dept b <span class="keyword">ON</span> b.user_id<span class="operator">=</span> a.id</span><br></pre></td></tr></table></figure>

<p><code>v5.0.2+</code>版本开始，可以传入数组批量设置数据表以及别名，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">alias</span>([<span class="string">&#x27;think_user&#x27;</span>=&gt;<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;think_dept&#x27;</span>=&gt;<span class="string">&#x27;dept&#x27;</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">join</span>(<span class="string">&#x27;think_dept&#x27;</span>,<span class="string">&#x27;dept.user_id= user.id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>最终生成的SQL语句类似于：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> think_user <span class="keyword">user</span> <span class="keyword">INNER</span> <span class="keyword">JOIN</span> think_dept dept <span class="keyword">ON</span> dept.user_id<span class="operator">=</span> user.id</span><br></pre></td></tr></table></figure>



<h1 id="field"><a href="#field" class="headerlink" title="field"></a>field</h1><hr>
<p>field方法属于模型的连贯操作方法之一，主要目的是标识要返回或者操作的字段，可以用于查询和写入操作。</p>
<h2 id="用于查询"><a href="#用于查询" class="headerlink" title="用于查询"></a>用于查询</h2><h5 id="指定字段"><a href="#指定字段" class="headerlink" title="指定字段"></a>指定字段</h5><p>在查询操作中field方法是使用最频繁的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;id,title,content&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>这里使用field方法指定了查询的结果集中包含id,title,content三个字段的值。执行的SQL相当于：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,title,content <span class="keyword">FROM</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<p>可以给某个字段设置别名，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;id,nickname as name&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>执行的SQL语句相当于：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,nickname <span class="keyword">as</span> name <span class="keyword">FROM</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<h5 id="使用SQL函数"><a href="#使用SQL函数" class="headerlink" title="使用SQL函数"></a>使用SQL函数</h5><p>可以在field方法中直接使用函数，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;id,SUM(score)&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>执行的SQL相当于：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,<span class="built_in">SUM</span>(score) <span class="keyword">FROM</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>除了select方法之外，所有的查询方法，包括find等都可以使用field方法。</p>
</blockquote>
<h5 id="使用数组参数"><a href="#使用数组参数" class="headerlink" title="使用数组参数"></a>使用数组参数</h5><p>field方法的参数可以支持数组，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>([<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;content&#x27;</span>])-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>最终执行的SQL和前面用字符串方式是等效的。</p>
<p>数组方式的定义可以为某些字段定义别名，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>([<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;nickname&#x27;</span>=&gt;<span class="string">&#x27;name&#x27;</span>])-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>执行的SQL相当于：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,nickname <span class="keyword">as</span> name <span class="keyword">FROM</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<p>对于一些更复杂的字段要求，数组的优势则更加明显，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">field</span>([<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;concat(name,&quot;-&quot;,id)&#x27;</span>=&gt;<span class="string">&#x27;truename&#x27;</span>,<span class="string">&#x27;LEFT(title,7)&#x27;</span>=&gt;<span class="string">&#x27;sub_title&#x27;</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>执行的SQL相当于：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,concat(name,<span class="string">&#x27;-&#x27;</span>,id) <span class="keyword">as</span> truename,<span class="keyword">LEFT</span>(title,<span class="number">7</span>) <span class="keyword">as</span> sub_title <span class="keyword">FROM</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<h5 id="获取所有字段"><a href="#获取所有字段" class="headerlink" title="获取所有字段"></a>获取所有字段</h5><p>如果有一个表有非常多的字段，需要获取所有的字段（这个也许很简单，因为不调用field方法或者直接使用空的field方法都能做到）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();<span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;*&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>上面的用法是等效的，都相当于执行SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<p>但是这并不是我说的获取所有字段，而是显式的调用所有字段（对于对性能要求比较高的系统，这个要求并不过分，起码是一个比较好的习惯），下面的用法可以完成预期的作用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="literal">true</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p><code>field(true)</code>的用法会显式的获取数据表的所有字段列表，哪怕你的数据表有100个字段。</p>
<h5 id="字段排除"><a href="#字段排除" class="headerlink" title="字段排除"></a>字段排除</h5><p>如果我希望获取排除数据表中的<code>content</code>字段（文本字段的值非常耗内存）之外的所有字段值，我们就可以使用field方法的排除功能，例如下面的方式就可以实现所说的功能：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;content&#x27;</span>,<span class="literal">true</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>则表示获取除了content之外的所有字段，要排除更多的字段也可以：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;user_id,content&#x27;</span>,<span class="literal">true</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br><span class="line"><span class="comment">//或者用</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>([<span class="string">&#x27;user_id&#x27;</span>,<span class="string">&#x27;content&#x27;</span>],<span class="literal">true</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意的是 字段排除功能不支持跨表和join操作。</p>
</blockquote>
<h2 id="用于写入"><a href="#用于写入" class="headerlink" title="用于写入"></a>用于写入</h2><p>除了查询操作之外，field方法还有一个非常重要的安全功能–<strong>字段合法性检测</strong>。field方法结合数据库的写入方法使用就可以完成表单提交的字段合法性检测，如果我们在表单提交的处理方法中使用了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;title,email,content&#x27;</span>)-&gt;<span class="title function_ invoke__">insert</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>

<p>即表示表单中的合法字段只有<code>title</code>,<code>email</code>和<code>content</code>字段，无论用户通过什么手段更改或者添加了浏览器的提交字段，都会直接屏蔽。因为，其他是所有字段我们都不希望由用户提交来决定，你可以通过自动完成功能定义额外的字段写入。</p>
<h1 id="order"><a href="#order" class="headerlink" title="order"></a>order</h1><hr>
<p>order方法属于模型的连贯操作方法之一，用于对操作的结果排序。</p>
<p>用法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status=1&#x27;</span>)-&gt;<span class="title function_ invoke__">order</span>(<span class="string">&#x27;id desc&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">5</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>注意：连贯操作方法没有顺序，可以在select方法调用之前随便改变调用顺序。</p>
<p>支持对多个字段的排序，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status=1&#x27;</span>)-&gt;<span class="title function_ invoke__">order</span>(<span class="string">&#x27;id desc,status&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">5</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果没有指定desc或者asc排序规则的话，默认为asc。</p>
</blockquote>
<p>如果你的字段和mysql关键字有冲突，那么建议采用数组方式调用，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status=1&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">order</span>([<span class="string">&#x27;order&#x27;</span>,<span class="string">&#x27;id&#x27;</span>=&gt;<span class="string">&#x27;desc&#x27;</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">limit</span>(<span class="number">5</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>(); </span><br></pre></td></tr></table></figure>



<h1 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h1><hr>
<p>limit方法也是模型类的连贯操作方法之一，主要用于指定查询和操作的数量，特别在分页查询的时候使用较多。ThinkPHP的limit方法可以兼容所有的数据库驱动类的。</p>
<h2 id="限制结果数量"><a href="#限制结果数量" class="headerlink" title="限制结果数量"></a>限制结果数量</h2><p>例如获取满足要求的10个用户，如下调用即可：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;status=1&#x27;</span>)-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;id,name&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">10</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>limit方法也可以用于写操作，例如更新满足要求的3条数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;score=100&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">3</span>)-&gt;<span class="title function_ invoke__">update</span>([<span class="string">&#x27;level&#x27;</span>=&gt;<span class="string">&#x27;A&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><p>用于文章分页查询是limit方法比较常用的场合，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="string">&#x27;10,25&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>表示查询文章数据，从第10行开始的25条数据（可能还取决于where条件和order排序的影响 这个暂且不提）。</p>
<p>你也可以这样使用，作用是一样的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="number">10</span>,<span class="number">25</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>对于大数据表，尽量使用limit限制查询结果，否则会导致很大的内存开销和性能问题。</p>
<h1 id="page"><a href="#page" class="headerlink" title="page"></a>page</h1><hr>
<p>page方法也是模型的连贯操作方法之一，是完全为分页查询而诞生的一个人性化操作方法。</p>
<p>我们在前面已经了解了关于limit方法用于分页查询的情况，而page方法则是更人性化的进行分页查询的方法，例如还是以文章列表分页为例来说，如果使用limit方法，我们要查询第一页和第二页（假设我们每页输出10条数据）写法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询第一页数据</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="string">&#x27;0,10&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>(); </span><br><span class="line"><span class="comment">// 查询第二页数据</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)-&gt;<span class="title function_ invoke__">limit</span>(<span class="string">&#x27;10,10&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>(); </span><br></pre></td></tr></table></figure>

<p>虽然利用扩展类库中的分页类Page可以自动计算出每个分页的limit参数，但是如果要自己写就比较费力了，如果用page方法来写则简单多了，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询第一页数据</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">page</span>(<span class="string">&#x27;1,10&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>(); </span><br><span class="line"><span class="comment">// 查询第二页数据</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">page</span>(<span class="string">&#x27;2,10&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>(); </span><br></pre></td></tr></table></figure>

<p>显而易见的是，使用page方法你不需要计算每个分页数据的起始位置，page方法内部会自动计算。</p>
<p>和limit方法一样，page方法也支持2个参数的写法，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">page</span>(<span class="number">1</span>,<span class="number">10</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br><span class="line"><span class="comment">// 和下面的用法等效</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">page</span>(<span class="string">&#x27;1,10&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>page方法还可以和limit方法配合使用，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">limit</span>(<span class="number">25</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">page</span>(<span class="number">3</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>当page方法只有一个值传入的时候，表示第几页，而limit方法则用于设置每页显示的数量，也就是说上面的写法等同于：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_article&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">page</span>(<span class="string">&#x27;3,25&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>(); </span><br></pre></td></tr></table></figure>



<h1 id="group"><a href="#group" class="headerlink" title="group"></a>group</h1><hr>
<p>GROUP方法也是连贯操作方法之一，通常用于结合合计函数，根据一个或多个列对结果集进行分组 。</p>
<p>group方法只有一个参数，并且只能使用字符串。</p>
<p>例如，我们都查询结果按照用户id进行分组统计：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;user_id,username,max(score)&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">group</span>(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>生成的SQL语句是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user_id,username,<span class="built_in">max</span>(score) <span class="keyword">FROM</span> think_score <span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id</span><br></pre></td></tr></table></figure>

<p>也支持对多个字段进行分组，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;user_id,test_time,username,max(score)&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">group</span>(<span class="string">&#x27;user_id,test_time&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>生成的SQL语句是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user_id,test_time,username,<span class="built_in">max</span>(score) <span class="keyword">FROM</span> think_score <span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id,test_time</span><br></pre></td></tr></table></figure>



<h1 id="having"><a href="#having" class="headerlink" title="having"></a>having</h1><hr>
<p>HAVING方法也是连贯操作之一，用于配合group方法完成从分组的结果中筛选（通常是聚合条件）数据。</p>
<p>having方法只有一个参数，并且只能使用字符串，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;username,max(score)&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">group</span>(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">having</span>(<span class="string">&#x27;count(test_time)&gt;3&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>(); </span><br></pre></td></tr></table></figure>

<p>生成的SQL语句是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username,<span class="built_in">max</span>(score) <span class="keyword">FROM</span> think_score <span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id <span class="keyword">HAVING</span> <span class="built_in">count</span>(test_time)<span class="operator">&gt;</span><span class="number">3</span></span><br></pre></td></tr></table></figure>



<h1 id="join"><a href="#join" class="headerlink" title="join"></a>join</h1><hr>
<p>join通常有下面几种类型，不同类型的join操作会影响返回的数据结果。</p>
<ul>
<li><strong>INNER JOIN</strong>: 等同于 JOIN（默认的JOIN类型）,如果表中有至少一个匹配，则返回行</li>
<li><strong>LEFT JOIN</strong>: 即使右表中没有匹配，也从左表返回所有的行</li>
<li><strong>RIGHT JOIN</strong>: 即使左表中没有匹配，也从右表返回所有的行</li>
<li><strong>FULL JOIN</strong>: 只要其中一个表中存在匹配，就返回行</li>
</ul>
<p><strong>说明</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> <span class="title function_ invoke__">join</span> ( <span class="keyword">mixed</span> join [, <span class="keyword">mixed</span> <span class="variable">$condition</span> = <span class="literal">null</span> [, <span class="keyword">string</span> <span class="variable">$type</span> = <span class="string">&#x27;INNER&#x27;</span>]] )</span><br></pre></td></tr></table></figure>

<p>JOIN方法也是连贯操作方法之一，用于根据两个或多个表中的列之间的关系，从这些表中查询数据。</p>
<p><strong>参数</strong></p>
<h4 id="join-1"><a href="#join-1" class="headerlink" title="join"></a>join</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要关联的（完整）表名以及别名</span><br></pre></td></tr></table></figure>

<p>支持三种写法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">写法1：[ &#x27;完整表名或者子查询&#x27;=&gt;&#x27;别名&#x27; ]</span><br><span class="line">写法2：&#x27;完整表名 别名&#x27;</span><br><span class="line">写法3：&#x27;不带数据表前缀的表名&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="condition"><a href="#condition" class="headerlink" title="condition"></a>condition</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关联条件。可以为字符串或数组， 为数组时每一个元素都是一个关联条件。</span><br></pre></td></tr></table></figure>

<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关联类型。可以为:INNER、LEFT、RIGHT、FULL，不区分大小写，默认为INNER。</span><br></pre></td></tr></table></figure>

<p><strong>返回值</strong><br>模型对象</p>
<p><strong>举例</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_artist&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">alias</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">join</span>(<span class="string">&#x27;think_work w&#x27;</span>,<span class="string">&#x27;a.id = w.artist_id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">join</span>(<span class="string">&#x27;think_card c&#x27;</span>,<span class="string">&#x27;a.card_id = c.id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_artist&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">alias</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">join</span>(<span class="string">&#x27;__WORK__ w&#x27;</span>,<span class="string">&#x27;a.id = w.artist_id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">join</span>(<span class="string">&#x27;__CARD__ c&#x27;</span>,<span class="string">&#x27;a.card_id = c.id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$join</span> = [    </span><br><span class="line">    [<span class="string">&#x27;think_work w&#x27;</span>,<span class="string">&#x27;a.id=w.artist_id&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;think_card c&#x27;</span>,<span class="string">&#x27;a.card_id=c.id&#x27;</span>],];</span><br><span class="line"></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">alias</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">join</span>(<span class="variable">$join</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>以上三种写法的效果一样，<code>__WORK__</code>和 <code>__CARD__</code>在最终解析的时候会转换为 <code>think_work</code>和 <code>think_card</code>。注意:’<em>*表名</em>*’这种方式中间的表名需要用大写</p>
<p>如果不想使用别名，后面的条件就要使用表全名，可以使用下面这种方式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">join</span>(<span class="string">&#x27;__WORK__&#x27;</span>,<span class="string">&#x27;__ARTIST__.id = __WORK__.artist_id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>默认采用INNER JOIN 方式，如果需要用其他的JOIN方式，可以改成</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">alias</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">join</span>(<span class="string">&#x27;word w&#x27;</span>,<span class="string">&#x27;a.id = w.artist_id&#x27;</span>,<span class="string">&#x27;RIGHT&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>表名也可以是一个子查询</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$subsql</span> = <span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_work&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="number">1</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;artist_id,count(id) count&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">group</span>(<span class="string">&#x27;artist_id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">buildSql</span>();</span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">alias</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">join</span>([<span class="variable">$subsql</span>=&gt; <span class="string">&#x27;w&#x27;</span>], <span class="string">&#x27;a.artist_id = w.artist_id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>因buildSql返回的语句带有()，所以这里不需要在两端再加上()。</p>
<h1 id="union"><a href="#union" class="headerlink" title="union"></a>union</h1><hr>
<p>UNION操作用于合并两个或多个 SELECT 语句的结果集。</p>
<p>使用示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">field</span>(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user_0&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">union</span>(<span class="string">&#x27;SELECT name FROM think_user_1&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">union</span>(<span class="string">&#x27;SELECT name FROM think_user_2&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>闭包用法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">field</span>(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user_0&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">union</span>(function(<span class="variable">$query</span>)&#123;</span><br><span class="line">        <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user_1&#x27;</span>);</span><br><span class="line">    &#125;)      </span><br><span class="line">    -&gt;<span class="title function_ invoke__">union</span>(function(<span class="variable">$query</span>)&#123;</span><br><span class="line">        <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;name&#x27;</span>)-&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user_2&#x27;</span>);</span><br><span class="line">    &#125;)      </span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">field</span>(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user_0&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">union</span>([<span class="string">&#x27;SELECT name FROM think_user_1&#x27;</span>,<span class="string">&#x27;SELECT name FROM think_user_2&#x27;</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>支持UNION ALL 操作，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">field</span>(<span class="string">&#x27;name&#x27;</span>)      </span><br><span class="line">    -&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user_0&#x27;</span>)      </span><br><span class="line">    -&gt;<span class="title function_ invoke__">union</span>(<span class="string">&#x27;SELECT name FROM think_user_1&#x27;</span>,<span class="literal">true</span>)      </span><br><span class="line">    -&gt;<span class="title function_ invoke__">union</span>(<span class="string">&#x27;SELECT name FROM think_user_2&#x27;</span>,<span class="literal">true</span>)      </span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">field</span>(<span class="string">&#x27;name&#x27;</span>)      </span><br><span class="line">    -&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user_0&#x27;</span>)      </span><br><span class="line">    -&gt;<span class="title function_ invoke__">union</span>([<span class="string">&#x27;SELECT name FROM think_user_1&#x27;</span>,<span class="string">&#x27;SELECT name FROM think_user_2&#x27;</span>],<span class="literal">true</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>每个union方法相当于一个独立的SELECT语句。</p>
<blockquote>
<p>注意：UNION 内部的 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条 SELECT 语句中的列的顺序必须相同。</p>
</blockquote>
<h1 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h1><hr>
<p>DISTINCT 方法用于返回唯一不同的值 。</p>
<p>例如数据库表中有以下数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ku.shouce.ren/files/images/201701/587cd268eef70.jpg" alt="img"></p>
<p>以下代码会返回<code>user_login</code>字段不同的数据</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">distinct</span>(<span class="literal">true</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;user_login&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>生成的SQL语句是： <code>SELECT DISTINCT user_login FROM think_user</code></p>
<p>返回以下数组</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">    [<span class="number">0</span>] =&gt; <span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        [<span class="string">&quot;user_login&quot;</span>] =&gt; <span class="keyword">string</span>(<span class="number">7</span>) <span class="string">&quot;chunice&quot;</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">    [<span class="number">1</span>] =&gt; <span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        [<span class="string">&quot;user_login&quot;</span>] =&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;admin&quot;</span>  </span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>distinct方法的参数是一个布尔值。</p>
<h1 id="lock"><a href="#lock" class="headerlink" title="lock"></a>lock</h1><hr>
<p>Lock方法是用于数据库的锁机制，如果在查询或者执行操作的时候使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">lock</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>就会自动在生成的SQL语句最后加上 <code>FOR UPDATE</code>或者<code>FOR UPDATE NOWAIT</code>（Oracle数据库）。</p>
<h1 id="cache"><a href="#cache" class="headerlink" title="cache"></a>cache</h1><hr>
<p>cache方法用于查询缓存操作，也是连贯操作方法之一。</p>
<p><strong>cache</strong>可以用于<code>select</code>、<code>find</code>、<code>value</code>和<code>column</code>方法，以及其衍生方法，使用<code>cache</code>方法后，在缓存有效期之内不会再次进行数据库查询操作，而是直接获取缓存中的数据，关于数据缓存的类型和设置可以参考缓存部分。</p>
<p>下面举例说明，例如，我们对find方法使用cache方法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id=5&#x27;</span>)-&gt;<span class="title function_ invoke__">cache</span>(<span class="literal">true</span>)-&gt;<span class="title function_ invoke__">find</span>();</span><br></pre></td></tr></table></figure>

<p>第一次查询结果会被缓存，第二次查询相同的数据的时候就会直接返回缓存中的内容，而不需要再次进行数据库查询操作。</p>
<p>默认情况下， 缓存有效期是由默认的缓存配置参数决定的，但<code>cache</code>方法可以单独指定，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">cache</span>(<span class="literal">true</span>,<span class="number">60</span>)-&gt;<span class="title function_ invoke__">find</span>();</span><br><span class="line"><span class="comment">// 或者使用下面的方式 是等效的</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">cache</span>(<span class="number">60</span>)-&gt;<span class="title function_ invoke__">find</span>();</span><br></pre></td></tr></table></figure>

<p>表示对查询结果的缓存有效期60秒。</p>
<p>cache方法可以指定缓存标识：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">cache</span>(<span class="string">&#x27;key&#x27;</span>,<span class="number">60</span>)-&gt;<span class="title function_ invoke__">find</span>();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>指定查询缓存的标识可以使得查询缓存更有效率。</p>
</blockquote>
<p>这样，在外部就可以通过<code>\think\Cache</code>类直接获取查询缓存的数据，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$result</span> = <span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">cache</span>(<span class="string">&#x27;key&#x27;</span>,<span class="number">60</span>)-&gt;<span class="title function_ invoke__">find</span>();</span><br><span class="line"><span class="variable">$data</span> = \think<span class="title class_">\Cache</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;key&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>cache</code>方法支持设置缓存标签，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">cache</span>(<span class="string">&#x27;key&#x27;</span>,<span class="number">60</span>,<span class="string">&#x27;tagName&#x27;</span>)-&gt;<span class="title function_ invoke__">find</span>();</span><br></pre></td></tr></table></figure>

<h2 id="缓存自动更新"><a href="#缓存自动更新" class="headerlink" title="缓存自动更新"></a>缓存自动更新</h2><p>这里的缓存自动更新是指一旦数据更新或者删除后会自动清理缓存（下次获取的时候会自动重新缓存）。</p>
<p>当你删除或者更新数据的时候，可以使用cache方法手动更新（清除）缓存，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">cache</span>(<span class="string">&#x27;user_data&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>([<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>]);</span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">cache</span>(<span class="string">&#x27;user_data&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">update</span>([<span class="string">&#x27;id&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;thinkphp&#x27;</span>]);</span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">cache</span>(<span class="string">&#x27;user_data&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>([<span class="number">1</span>,<span class="number">5</span>]);</span><br></pre></td></tr></table></figure>

<p>最后查询的数据不会受第一条查询缓存的影响，确保查询和更新或者删除使用相同的缓存标识才能自动清除缓存。</p>
<p>如果使用<code>find</code>方法并且使用主键查询的情况，不需要指定缓存标识，会自动清理缓存，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">cache</span>(<span class="literal">true</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">find</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">update</span>([<span class="string">&#x27;id&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;thinkphp&#x27;</span>]);</span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">cache</span>(<span class="literal">true</span>)-&gt;<span class="title function_ invoke__">find</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>最后查询的数据会是更新后的数据。</p>
<h1 id="comment"><a href="#comment" class="headerlink" title="comment"></a>comment</h1><hr>
<p>COMMENT方法 用于在生成的SQL语句中添加注释内容，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_score&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">comment</span>(<span class="string">&#x27;查询考试前十名分数&#x27;</span>)    </span><br><span class="line">    -&gt;<span class="title function_ invoke__">field</span>(<span class="string">&#x27;username,score&#x27;</span>)    </span><br><span class="line">    -&gt;<span class="title function_ invoke__">limit</span>(<span class="number">10</span>)    </span><br><span class="line">    -&gt;<span class="title function_ invoke__">order</span>(<span class="string">&#x27;score desc&#x27;</span>)    </span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>最终生成的SQL语句是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username,score <span class="keyword">FROM</span> think_score <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">desc</span> LIMIT <span class="number">10</span> <span class="comment">/* 查询考试前十名分数 */</span></span><br></pre></td></tr></table></figure>



<h1 id="fetchSql"><a href="#fetchSql" class="headerlink" title="fetchSql"></a>fetchSql</h1><hr>
<p>fetchSql用于直接返回SQL而不是执行查询，适用于任何的CURD操作方法。 例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$result</span> = <span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">fetchSql</span>(<span class="literal">true</span>)-&gt;<span class="title function_ invoke__">find</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>输出result结果为： <code>SELECT * FROM think_user where id = 1</code></p>
<h1 id="force"><a href="#force" class="headerlink" title="force"></a>force</h1><hr>
<p>force 方法用于数据集的强制索引操作，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)-&gt;<span class="title function_ invoke__">force</span>(<span class="string">&#x27;user&#x27;</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>对查询强制使用user索引，user必须是数据表实际创建的索引名称。</p>
<h1 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h1><hr>
<p>bind方法用于手动参数绑定，大多数情况，无需进行手动绑定，系统会在查询和写入数据的时候自动使用参数绑定。</p>
<p>bind方法用法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于查询</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;:name&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">bind</span>([<span class="string">&#x27;id&#x27;</span>=&gt;[<span class="number">10</span>,\PDO::<span class="variable constant_">PARAM_INT</span>],<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;thinkphp&#x27;</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br><span class="line"><span class="comment">// 用于写入</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">table</span>(<span class="string">&#x27;think_user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">bind</span>([<span class="string">&#x27;id&#x27;</span>=&gt;[<span class="number">10</span>,\PDO::<span class="variable constant_">PARAM_INT</span>],<span class="string">&#x27;email&#x27;</span>=&gt;<span class="string">&#x27;thinkphp@qq.com&#x27;</span>,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;thinkphp&#x27;</span>])</span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">update</span>([<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;:name&#x27;</span>,<span class="string">&#x27;email&#x27;</span>=&gt;<span class="string">&#x27;:email&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h1 id="partition"><a href="#partition" class="headerlink" title="partition"></a>partition</h1><hr>
<p>partition 方法用于是数据库水平分表</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">partition</span>(<span class="variable">$data</span>, <span class="variable">$field</span>, <span class="variable">$rule</span>);</span><br><span class="line"><span class="comment">// $data 分表字段的数据</span></span><br><span class="line"><span class="comment">// $field 分表字段的名称</span></span><br><span class="line"><span class="comment">// $rule 分表规则</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：不要使用任何 SQL 语句中会出现的关键字当表名、字段名，例如 order 等。会导致数据模型拼装 SQL 语句语法错误。</strong></p>
<p>partition 方法用法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于写入</span></span><br><span class="line"><span class="variable">$data</span> = [</span><br><span class="line">    <span class="string">&#x27;user_id&#x27;</span>   =&gt; <span class="number">110</span>,</span><br><span class="line">    <span class="string">&#x27;user_name&#x27;</span> =&gt; <span class="string">&#x27;think&#x27;</span></span><br><span class="line">];</span><br><span class="line"><span class="variable">$rule</span> = [    </span><br><span class="line">    <span class="string">&#x27;type&#x27;</span> =&gt; <span class="string">&#x27;mod&#x27;</span>, <span class="comment">// 分表方式</span></span><br><span class="line">    <span class="string">&#x27;num&#x27;</span>  =&gt; <span class="number">10</span>     <span class="comment">// 分表数量</span></span><br><span class="line">];</span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">name</span>(<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">partition</span>([<span class="string">&#x27;user_id&#x27;</span> =&gt; <span class="number">110</span>], <span class="string">&quot;user_id&quot;</span>, <span class="variable">$rule</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">insert</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="comment">// 用于查询</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">name</span>(<span class="string">&#x27;log&#x27;</span>)    </span><br><span class="line">    -&gt;<span class="title function_ invoke__">partition</span>([<span class="string">&#x27;user_id&#x27;</span> =&gt; <span class="number">110</span>], <span class="string">&quot;user_id&quot;</span>, <span class="variable">$rule</span>)    </span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>([<span class="string">&#x27;user_id&#x27;</span> =&gt; <span class="number">110</span>])    </span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>



<h1 id="strict"><a href="#strict" class="headerlink" title="strict"></a>strict</h1><hr>
<p><code>strict</code>方法用于设置是否严格检查字段名，用法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关闭字段严格检查</span></span><br><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">name</span>(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">strict</span>(<span class="literal">false</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">insert</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>

<p>注意，系统默认值是由数据库配置参数<code>fields_strict</code>决定，因此修改数据库配置参数可以进行全局的严格检查配置，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 关闭严格检查字段是否存在</span><br><span class="line">&#x27;fields_strict&#x27;  =&gt; false,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果开启字段严格检查的话，在更新和写入数据库的时候，一旦存在非数据表字段的值，则会抛出异常。</p>
</blockquote>
<h1 id="failException"><a href="#failException" class="headerlink" title="failException"></a>failException</h1><hr>
<p><code>failException</code>设置查询数据为空时是否需要抛出异常，如果不传入任何参数，默认为开启，用于<code>select</code>和<code>find</code>方法，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据不存在的话直接抛出异常</span></span><br><span class="line">Db:<span class="title function_ invoke__">name</span>(<span class="string">&#x27;blog&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>([<span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">1</span>])-&gt;<span class="title function_ invoke__">failException</span>()-&gt;<span class="title function_ invoke__">select</span>();</span><br><span class="line"><span class="comment">// 数据不存在返回空数组 不抛异常</span></span><br><span class="line">Db:<span class="title function_ invoke__">name</span>(<span class="string">&#x27;blog&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>([<span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">1</span>])-&gt;<span class="title function_ invoke__">failException</span>(<span class="literal">false</span>)-&gt;<span class="title function_ invoke__">select</span>();</span><br></pre></td></tr></table></figure>

<p>或者可以使用更方便的查空报错</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询多条</span></span><br><span class="line">Db:<span class="title function_ invoke__">name</span>(<span class="string">&#x27;blog&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>([<span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">1</span>])-&gt;<span class="title function_ invoke__">selectOrFail</span>();</span><br><span class="line"><span class="comment">// 查询单条</span></span><br><span class="line">Db:<span class="title function_ invoke__">name</span>(<span class="string">&#x27;blog&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>([<span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">1</span>])-&gt;<span class="title function_ invoke__">findOrFail</span>();</span><br></pre></td></tr></table></figure>



<h1 id="sequence"><a href="#sequence" class="headerlink" title="sequence"></a>sequence</h1><hr>
<p><code>sequence</code>方法用于<code>pgsql</code>数据库指定自增序列名，其它数据库不必使用，用法为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Db</span>::<span class="title function_ invoke__">name</span>(<span class="string">&#x27;user&#x27;</span>)-&gt;<span class="title function_ invoke__">sequence</span>(<span class="string">&#x27;id&#x27;</span>)-&gt;<span class="title function_ invoke__">insert</span>([<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;thinkphp&#x27;</span>]);</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://2486125878.github.io">凯瑟兰森</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://2486125878.github.io/2024/03/14/thinkphp%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C/">https://2486125878.github.io/2024/03/14/thinkphp%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/php/">php</a></div><div class="post_share"><div class="social-share" data-image="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/03/14/thinkphp%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2/" title="thinkphp多种查询"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">thinkphp多种查询</div></div></a></div><div class="next-post pull-right"><a href="/2024/03/14/%E6%9F%A5%E8%AF%A2%E6%9E%84%E9%80%A0%E5%99%A8/" title="查询构造器"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next</div><div class="next_info">查询构造器</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2024/03/13/thinkphp/" title="thinkphp"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-13</div><div class="title">thinkphp</div></div></a></div><div><a href="/2024/03/14/thinkphp%E5%90%8E%E5%8F%B0%E7%AC%94%E8%AE%B0/" title="thinkphp后台笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">thinkphp后台笔记</div></div></a></div><div><a href="/2024/03/13/thinkphp-sql/" title="thinkphp_sql"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-13</div><div class="title">thinkphp_sql</div></div></a></div><div><a href="/2024/03/14/thinkphp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="thinkphp学习笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">thinkphp学习笔记</div></div></a></div><div><a href="/2024/03/14/thinkphp%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B6%E4%BB%96/" title="thinkphp数据库其他"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">thinkphp数据库其他</div></div></a></div><div><a href="/2024/03/14/thinkphp%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2/" title="thinkphp多种查询"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">thinkphp多种查询</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img0.baidu.com/it/u=571211534,249494121&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=800&amp;h=800" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">凯瑟兰森</div><div class="author-info__description">...</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/xu-kai666"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://gitee.com/xu-kai666" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2486125878@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text">链式操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#where"><span class="toc-number">2.</span> <span class="toc-text">where</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.1.</span> <span class="toc-text">表达式查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">数组条件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.2.1.</span> <span class="toc-text">普通查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">表达式查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">字符串条件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#table"><span class="toc-number">3.</span> <span class="toc-text">table</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-number">3.1.</span> <span class="toc-text">用法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#alias"><span class="toc-number">4.</span> <span class="toc-text">alias</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#field"><span class="toc-number">5.</span> <span class="toc-text">field</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.1.</span> <span class="toc-text">用于查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5"><span class="toc-number">5.1.0.0.1.</span> <span class="toc-text">指定字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8SQL%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.0.0.2.</span> <span class="toc-text">使用SQL函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E7%BB%84%E5%8F%82%E6%95%B0"><span class="toc-number">5.1.0.0.3.</span> <span class="toc-text">使用数组参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5"><span class="toc-number">5.1.0.0.4.</span> <span class="toc-text">获取所有字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E6%8E%92%E9%99%A4"><span class="toc-number">5.1.0.0.5.</span> <span class="toc-text">字段排除</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E5%86%99%E5%85%A5"><span class="toc-number">5.2.</span> <span class="toc-text">用于写入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#order"><span class="toc-number">6.</span> <span class="toc-text">order</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#limit"><span class="toc-number">7.</span> <span class="toc-text">limit</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E7%BB%93%E6%9E%9C%E6%95%B0%E9%87%8F"><span class="toc-number">7.1.</span> <span class="toc-text">限制结果数量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.2.</span> <span class="toc-text">分页查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#page"><span class="toc-number">8.</span> <span class="toc-text">page</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#group"><span class="toc-number">9.</span> <span class="toc-text">group</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#having"><span class="toc-number">10.</span> <span class="toc-text">having</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#join"><span class="toc-number">11.</span> <span class="toc-text">join</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#join-1"><span class="toc-number">11.0.0.1.</span> <span class="toc-text">join</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#condition"><span class="toc-number">11.0.0.2.</span> <span class="toc-text">condition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#type"><span class="toc-number">11.0.0.3.</span> <span class="toc-text">type</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#union"><span class="toc-number">12.</span> <span class="toc-text">union</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#distinct"><span class="toc-number">13.</span> <span class="toc-text">distinct</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lock"><span class="toc-number">14.</span> <span class="toc-text">lock</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cache"><span class="toc-number">15.</span> <span class="toc-text">cache</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0"><span class="toc-number">15.1.</span> <span class="toc-text">缓存自动更新</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#comment"><span class="toc-number">16.</span> <span class="toc-text">comment</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fetchSql"><span class="toc-number">17.</span> <span class="toc-text">fetchSql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#force"><span class="toc-number">18.</span> <span class="toc-text">force</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bind"><span class="toc-number">19.</span> <span class="toc-text">bind</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#partition"><span class="toc-number">20.</span> <span class="toc-text">partition</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#strict"><span class="toc-number">21.</span> <span class="toc-text">strict</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#failException"><span class="toc-number">22.</span> <span class="toc-text">failException</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sequence"><span class="toc-number">23.</span> <span class="toc-text">sequence</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/thinkphp%E5%90%8E%E5%8F%B0%E7%AC%94%E8%AE%B0/" title="thinkphp后台笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="thinkphp后台笔记"/></a><div class="content"><a class="title" href="/2024/03/14/thinkphp%E5%90%8E%E5%8F%B0%E7%AC%94%E8%AE%B0/" title="thinkphp后台笔记">thinkphp后台笔记</a><time datetime="2024-03-14T07:51:34.000Z" title="Created 2024-03-14 15:51:34">2024-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/thinkphp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="thinkphp学习笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="thinkphp学习笔记"/></a><div class="content"><a class="title" href="/2024/03/14/thinkphp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="thinkphp学习笔记">thinkphp学习笔记</a><time datetime="2024-03-14T07:32:59.000Z" title="Created 2024-03-14 15:32:59">2024-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/thinkphp%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B6%E4%BB%96/" title="thinkphp数据库其他"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="thinkphp数据库其他"/></a><div class="content"><a class="title" href="/2024/03/14/thinkphp%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B6%E4%BB%96/" title="thinkphp数据库其他">thinkphp数据库其他</a><time datetime="2024-03-14T04:04:00.000Z" title="Created 2024-03-14 12:04:00">2024-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/thinkphp%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2/" title="thinkphp多种查询"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="thinkphp多种查询"/></a><div class="content"><a class="title" href="/2024/03/14/thinkphp%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2/" title="thinkphp多种查询">thinkphp多种查询</a><time datetime="2024-03-14T03:47:23.000Z" title="Created 2024-03-14 11:47:23">2024-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/thinkphp%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C/" title="thinkphp链式操作"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/0bd162d9f2d3572c03d4a3348113632762d0c327.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="thinkphp链式操作"/></a><div class="content"><a class="title" href="/2024/03/14/thinkphp%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C/" title="thinkphp链式操作">thinkphp链式操作</a><time datetime="2024-03-14T03:18:02.000Z" title="Created 2024-03-14 11:18:02">2024-03-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="footer"><div class="bubbles"><div class="bubble" style="--size:3.453748880790828rem; --distance:8.030843464087216rem; --position:66.30509161881567%; --time:3.627253283058393s; --delay:-2.3366468834450314s;"></div><div class="bubble" style="--size:2.7561220139822176rem; --distance:7.126364863282169rem; --position:93.57022613230565%; --time:2.114724311857946s; --delay:-3.741005470103601s;"></div><div class="bubble" style="--size:5.754790842941343rem; --distance:8.346713886884633rem; --position:32.899573656331526%; --time:3.396116611260295s; --delay:-2.5549692339604446s;"></div><div class="bubble" style="--size:2.0437264283453516rem; --distance:6.366191541156665rem; --position:102.32092995256528%; --time:3.4974962035265476s; --delay:-2.0066388311953305s;"></div><div class="bubble" style="--size:3.376817180614249rem; --distance:6.824567042304577rem; --position:74.45043339730213%; --time:3.3703940243430996s; --delay:-3.249596007622203s;"></div><div class="bubble" style="--size:2.4503260483756257rem; --distance:7.805648298345523rem; --position:94.17586316026487%; --time:2.17475855641043s; --delay:-2.415102665964665s;"></div><div class="bubble" style="--size:3.9733235188075327rem; --distance:8.390552438024805rem; --position:33.807551999667425%; --time:3.263071152389491s; --delay:-3.6940160125140573s;"></div><div class="bubble" style="--size:5.278216676260096rem; --distance:7.570295060784572rem; --position:12.180124862070617%; --time:3.6474288863646374s; --delay:-2.313343254146092s;"></div><div class="bubble" style="--size:2.3246411942219583rem; --distance:8.51330500099474rem; --position:102.13180580307791%; --time:3.233124677433705s; --delay:-2.068618398437702s;"></div><div class="bubble" style="--size:4.875661457116834rem; --distance:6.479407158537741rem; --position:34.277958757291614%; --time:2.5489110979436633s; --delay:-3.5464696519523895s;"></div><div class="bubble" style="--size:3.5816077711734113rem; --distance:9.78928342886839rem; --position:68.50381446696562%; --time:2.901728431666362s; --delay:-2.511634969177169s;"></div><div class="bubble" style="--size:2.651193193594062rem; --distance:9.580932881670904rem; --position:91.56627524045727%; --time:2.767835211980277s; --delay:-2.4664968069995803s;"></div><div class="bubble" style="--size:5.089375310157082rem; --distance:9.649618669626676rem; --position:63.76824739133109%; --time:2.564150096556486s; --delay:-2.6437851734052114s;"></div><div class="bubble" style="--size:3.101133041384996rem; --distance:8.105318819427195rem; --position:33.42055869537617%; --time:2.0505735517310817s; --delay:-3.2258214391365034s;"></div><div class="bubble" style="--size:4.9068351398990755rem; --distance:6.74731971552059rem; --position:70.19088332727692%; --time:2.849140865356034s; --delay:-2.29632780667284s;"></div><div class="bubble" style="--size:3.6806393318186377rem; --distance:7.320172358508744rem; --position:15.801554525553918%; --time:2.637108137454394s; --delay:-3.4759761961505995s;"></div><div class="bubble" style="--size:4.535829691532564rem; --distance:6.539765946889251rem; --position:51.22045527691169%; --time:3.1929827266698965s; --delay:-2.7075224527675044s;"></div><div class="bubble" style="--size:4.740672315041512rem; --distance:7.888391757705209rem; --position:-2.3310697034978123%; --time:3.6754817148735213s; --delay:-2.459341744469998s;"></div><div class="bubble" style="--size:4.02391930898034rem; --distance:6.198070868625958rem; --position:52.04400590207876%; --time:3.443839118477698s; --delay:-3.9394781033579394s;"></div><div class="bubble" style="--size:5.771167132694385rem; --distance:6.748850895027887rem; --position:60.45394068485112%; --time:2.535394179863841s; --delay:-3.1392038585711295s;"></div><div class="bubble" style="--size:2.0460151874514834rem; --distance:6.058041365047686rem; --position:40.45889197867188%; --time:2.8483092849208567s; --delay:-2.63941915754749s;"></div><div class="bubble" style="--size:2.839246289769619rem; --distance:7.786216777277123rem; --position:68.97763625648437%; --time:2.2891552406090496s; --delay:-2.740164719130875s;"></div><div class="bubble" style="--size:5.674006731456265rem; --distance:9.511768500086442rem; --position:24.871756278139777%; --time:3.1512043980151945s; --delay:-3.6108596557148123s;"></div><div class="bubble" style="--size:4.211536319722128rem; --distance:6.217890885255796rem; --position:29.018900285459672%; --time:3.3480510547195426s; --delay:-2.1013102376053094s;"></div><div class="bubble" style="--size:3.8681325166580667rem; --distance:9.137827731049319rem; --position:94.98921077889344%; --time:2.690835771575959s; --delay:-2.1586903674219924s;"></div><div class="bubble" style="--size:3.579322414829262rem; --distance:8.564691941251795rem; --position:45.28351753169683%; --time:2.632018686972476s; --delay:-3.5090133890215505s;"></div><div class="bubble" style="--size:3.540301299353131rem; --distance:7.809151084121432rem; --position:13.77196256269098%; --time:3.48883173517598s; --delay:-3.9046584134572093s;"></div><div class="bubble" style="--size:5.9214609705432215rem; --distance:9.192316423141236rem; --position:102.33245481919458%; --time:3.2261916785194518s; --delay:-3.8696855403560644s;"></div><div class="bubble" style="--size:5.602779666324139rem; --distance:7.416453040008612rem; --position:76.21774321927649%; --time:2.03051183025162s; --delay:-3.8447526272039467s;"></div><div class="bubble" style="--size:5.747468948494619rem; --distance:9.180173293583008rem; --position:82.13214785084257%; --time:2.3233256713827832s; --delay:-3.6332576746786485s;"></div><div class="bubble" style="--size:2.831534291352388rem; --distance:8.536656987632607rem; --position:98.40794498834603%; --time:3.0128407062327174s; --delay:-2.376120628006238s;"></div><div class="bubble" style="--size:2.620617192646556rem; --distance:9.071662342253141rem; --position:66.85994020102483%; --time:3.8061219495937997s; --delay:-3.162666995783128s;"></div><div class="bubble" style="--size:2.3316580779255585rem; --distance:6.603431059902358rem; --position:30.853773547390126%; --time:2.0608826746634112s; --delay:-3.611261750134862s;"></div><div class="bubble" style="--size:2.5957846340598607rem; --distance:8.694594987499283rem; --position:80.48695360852638%; --time:3.7065204837448675s; --delay:-3.01111426757755s;"></div><div class="bubble" style="--size:4.266972441381211rem; --distance:9.175149849263477rem; --position:9.140118690039664%; --time:3.3893626574831055s; --delay:-2.8059091475679607s;"></div><div class="bubble" style="--size:5.531455138680551rem; --distance:7.631754840299974rem; --position:89.89191499561514%; --time:3.565289852105648s; --delay:-2.594255053078265s;"></div><div class="bubble" style="--size:2.2381813739628287rem; --distance:6.436585115035612rem; --position:95.3573130153359%; --time:3.446241210564421s; --delay:-2.209381888025058s;"></div><div class="bubble" style="--size:2.8368204056555086rem; --distance:8.87422814154795rem; --position:54.98013904414873%; --time:3.404960289313437s; --delay:-3.361644407766785s;"></div><div class="bubble" style="--size:4.331303851067666rem; --distance:7.586908994138841rem; --position:79.10841964766226%; --time:2.3511186938286652s; --delay:-3.055506326569486s;"></div><div class="bubble" style="--size:4.880382574540027rem; --distance:8.146695476269487rem; --position:4.686040527332899%; --time:2.3297430778511017s; --delay:-3.7882387268868847s;"></div><div class="bubble" style="--size:5.689713543194778rem; --distance:9.03246202100565rem; --position:43.57472907564747%; --time:3.3667679111611406s; --delay:-2.564858577871156s;"></div><div class="bubble" style="--size:2.0676807815587948rem; --distance:6.981546138938256rem; --position:-2.139430539969802%; --time:2.18391136820567s; --delay:-3.6396121391914162s;"></div><div class="bubble" style="--size:4.903187035765433rem; --distance:7.626280307826657rem; --position:100.35165856894841%; --time:3.924096922808079s; --delay:-2.868154626783135s;"></div><div class="bubble" style="--size:5.904750527234582rem; --distance:7.8756465594197635rem; --position:98.9655504426602%; --time:3.792886596650833s; --delay:-2.680055681170824s;"></div><div class="bubble" style="--size:4.375095446481939rem; --distance:9.546097364266789rem; --position:11.06066358874481%; --time:3.7072513374321416s; --delay:-2.5065729014479277s;"></div><div class="bubble" style="--size:4.7142082301837736rem; --distance:6.631459126331322rem; --position:0.1615153839256811%; --time:3.3781236596868425s; --delay:-2.8991920496250674s;"></div><div class="bubble" style="--size:3.5403879320598524rem; --distance:9.810553495634785rem; --position:79.97163848856113%; --time:3.733108025011313s; --delay:-3.597060401438297s;"></div><div class="bubble" style="--size:3.43610109821833rem; --distance:9.413948204332156rem; --position:51.98156144241997%; --time:3.0796012476303702s; --delay:-2.474436568178514s;"></div><div class="bubble" style="--size:2.239236700857587rem; --distance:7.0017721427784645rem; --position:54.362279754159026%; --time:2.025819727647413s; --delay:-3.0347514274544762s;"></div><div class="bubble" style="--size:2.268066209006494rem; --distance:7.571266147967164rem; --position:41.011287356342365%; --time:2.1991958831364418s; --delay:-3.106763362657643s;"></div><div class="bubble" style="--size:5.0041131028886685rem; --distance:9.866368187945174rem; --position:72.53426270451354%; --time:2.0335462757213585s; --delay:-3.1406405290850588s;"></div><div class="bubble" style="--size:2.396071700515984rem; --distance:8.989520646731439rem; --position:66.71165470983196%; --time:2.410450023807737s; --delay:-2.870095250379316s;"></div><div class="bubble" style="--size:2.823637692961271rem; --distance:6.789548593448843rem; --position:67.4671834730359%; --time:2.7104772933014543s; --delay:-2.304887016597523s;"></div><div class="bubble" style="--size:2.152294375536604rem; --distance:8.037329042055468rem; --position:37.34789970593995%; --time:3.891778009740772s; --delay:-3.2906961940391843s;"></div><div class="bubble" style="--size:3.095338853151696rem; --distance:7.753170764277539rem; --position:-0.511383302755859%; --time:2.628744641534555s; --delay:-2.4908493504499907s;"></div><div class="bubble" style="--size:4.679280649579149rem; --distance:6.084567816496661rem; --position:51.0734998098337%; --time:2.2895261366845654s; --delay:-2.8256699581379108s;"></div><div class="bubble" style="--size:5.9161141924635094rem; --distance:8.018799338914373rem; --position:7.045666518411087%; --time:2.095031158144157s; --delay:-2.177228933717145s;"></div><div class="bubble" style="--size:3.0737015571285387rem; --distance:9.926227885062389rem; --position:64.81649669358792%; --time:2.535167721785852s; --delay:-2.4221410313175906s;"></div><div class="bubble" style="--size:4.387570817526324rem; --distance:8.821563292887134rem; --position:-2.0583142920198894%; --time:2.296167753303712s; --delay:-3.8220235798809408s;"></div><div class="bubble" style="--size:2.042128470512564rem; --distance:6.428924055720079rem; --position:29.03761951552483%; --time:3.3563995304133205s; --delay:-2.9516703146242245s;"></div><div class="bubble" style="--size:4.874711699238282rem; --distance:7.674502680081602rem; --position:90.23413427144459%; --time:3.4751620389126594s; --delay:-2.340939114638048s;"></div><div class="bubble" style="--size:2.9700015362264587rem; --distance:9.378968622465734rem; --position:60.31750253280853%; --time:3.2075042378151126s; --delay:-2.4494185997574554s;"></div><div class="bubble" style="--size:2.534654858044953rem; --distance:9.435194850749756rem; --position:-3.1914390237820878%; --time:3.940451897271256s; --delay:-2.5636306046807134s;"></div><div class="bubble" style="--size:5.707689178327416rem; --distance:7.093764728747514rem; --position:89.32850223423273%; --time:3.1188938791771923s; --delay:-2.4069691604505077s;"></div><div class="bubble" style="--size:5.6271521207192405rem; --distance:9.6032420297795rem; --position:73.97774692642601%; --time:3.686531669192512s; --delay:-3.328613708021177s;"></div><div class="bubble" style="--size:4.857556721328758rem; --distance:8.924671485786607rem; --position:39.32154726264615%; --time:3.098828629292898s; --delay:-3.384184921797429s;"></div><div class="bubble" style="--size:3.6770550438546454rem; --distance:9.315617111128436rem; --position:23.218331275426507%; --time:2.302799630308248s; --delay:-2.55530574963503s;"></div><div class="bubble" style="--size:4.522722126232746rem; --distance:7.312682007225184rem; --position:95.92883271824965%; --time:2.818003854093799s; --delay:-3.752695174945421s;"></div><div class="bubble" style="--size:2.6695850532721117rem; --distance:7.5819619591098775rem; --position:61.346039979905086%; --time:2.686404146739593s; --delay:-3.7486810855897668s;"></div><div class="bubble" style="--size:3.8780746166213653rem; --distance:6.715727586595654rem; --position:-3.3433881975995505%; --time:2.514966830607483s; --delay:-2.000981630817932s;"></div><div class="bubble" style="--size:4.552652781049274rem; --distance:9.008110232609rem; --position:28.124413503289922%; --time:2.253727121192854s; --delay:-2.8541162016311676s;"></div><div class="bubble" style="--size:4.299947675521207rem; --distance:6.772799877595707rem; --position:92.42626761457493%; --time:2.715402253304629s; --delay:-3.676580771530777s;"></div><div class="bubble" style="--size:5.454142242848884rem; --distance:9.087514784327427rem; --position:6.634292787209553%; --time:2.0324637542289197s; --delay:-2.82157765898317s;"></div><div class="bubble" style="--size:4.383444766549364rem; --distance:9.329544612585487rem; --position:19.898434881022563%; --time:3.2659960528001797s; --delay:-2.849537364453884s;"></div><div class="bubble" style="--size:5.997745129126153rem; --distance:7.511728740579596rem; --position:84.39350652371557%; --time:3.7740171736569654s; --delay:-2.343085550658937s;"></div><div class="bubble" style="--size:2.4649080433422705rem; --distance:9.954016110202847rem; --position:98.12745299598254%; --time:3.259933727022337s; --delay:-3.2369174831641794s;"></div><div class="bubble" style="--size:4.389156654368978rem; --distance:8.728502586800133rem; --position:100.45649216468361%; --time:2.78543358993189s; --delay:-3.9085663311988106s;"></div><div class="bubble" style="--size:5.723736998763686rem; --distance:6.685429188919823rem; --position:-2.082696687425174%; --time:2.3621850044292416s; --delay:-3.551558239441506s;"></div><div class="bubble" style="--size:5.996550602855951rem; --distance:9.179591629890425rem; --position:13.793781200684915%; --time:2.8685642629279564s; --delay:-3.8271853154909103s;"></div><div class="bubble" style="--size:2.7916873477473256rem; --distance:7.404632811782693rem; --position:45.15678569438596%; --time:2.673127289359847s; --delay:-3.0143345922922267s;"></div><div class="bubble" style="--size:4.216097045983498rem; --distance:7.211665752422713rem; --position:62.5258910852929%; --time:2.3128304413108896s; --delay:-2.1367348774101145s;"></div><div class="bubble" style="--size:5.127189132687522rem; --distance:8.282682082995986rem; --position:96.37718754063405%; --time:3.435801221238544s; --delay:-3.1196431698868334s;"></div><div class="bubble" style="--size:2.570081287791493rem; --distance:7.175077855764748rem; --position:92.84622914612942%; --time:3.410490062123651s; --delay:-3.490807274295083s;"></div><div class="bubble" style="--size:5.059589761370304rem; --distance:6.690483721338987rem; --position:46.439992840270726%; --time:2.017004096571284s; --delay:-3.1696252526464623s;"></div><div class="bubble" style="--size:5.522148353876117rem; --distance:9.2212556506679rem; --position:56.42824762886506%; --time:3.766727837707936s; --delay:-3.1777312703712486s;"></div><div class="bubble" style="--size:2.604158554585992rem; --distance:6.216453905794542rem; --position:75.20601542831697%; --time:3.1460657471370084s; --delay:-2.6186679370424533s;"></div><div class="bubble" style="--size:2.84900232372938rem; --distance:8.344827144341892rem; --position:91.80672978762443%; --time:2.685347110860143s; --delay:-3.562920688649105s;"></div><div class="bubble" style="--size:5.4907423273880855rem; --distance:8.668537970026662rem; --position:43.304504453001535%; --time:3.050761070905004s; --delay:-3.477516244204239s;"></div><div class="bubble" style="--size:2.7865014247800453rem; --distance:7.562200987144619rem; --position:92.29002167156544%; --time:3.2968771357338658s; --delay:-2.9400010669866075s;"></div><div class="bubble" style="--size:4.763211456200181rem; --distance:8.202926763254375rem; --position:54.64715941105462%; --time:3.8733958992201707s; --delay:-3.2339255743815154s;"></div><div class="bubble" style="--size:5.267443007148198rem; --distance:9.011389993758481rem; --position:96.18226621081689%; --time:3.5390319668185115s; --delay:-3.936093293441479s;"></div><div class="bubble" style="--size:3.9816257022172676rem; --distance:6.632252517080046rem; --position:87.41516896931432%; --time:2.003799199219745s; --delay:-2.3576757858063604s;"></div><div class="bubble" style="--size:3.471836305271899rem; --distance:7.359374592117282rem; --position:-2.8493719186084654%; --time:3.3576195223463445s; --delay:-2.6138233899496353s;"></div><div class="bubble" style="--size:2.253956293855322rem; --distance:6.571444739148822rem; --position:102.03311066928421%; --time:2.2616727323802253s; --delay:-2.5807553699132977s;"></div><div class="bubble" style="--size:2.8861290581858148rem; --distance:8.207581996287303rem; --position:77.63971216231393%; --time:2.5305781503698723s; --delay:-3.646626309950642s;"></div><div class="bubble" style="--size:3.115312021781156rem; --distance:8.264877806115116rem; --position:52.76146235872574%; --time:2.4912672420002133s; --delay:-3.029703910702335s;"></div><div class="bubble" style="--size:2.5538094609313946rem; --distance:9.377657638099262rem; --position:54.562616215233646%; --time:2.4574366586483865s; --delay:-2.4986924079945134s;"></div><div class="bubble" style="--size:2.211459653109258rem; --distance:8.423824148735532rem; --position:75.86202839937778%; --time:2.2335780214425367s; --delay:-2.1696063767894262s;"></div><div class="bubble" style="--size:4.789517273829809rem; --distance:8.582048897535163rem; --position:42.67041708028125%; --time:3.456076489593042s; --delay:-3.4611996259532227s;"></div><div class="bubble" style="--size:3.133150238410286rem; --distance:9.865827569540658rem; --position:47.63585029784546%; --time:3.9829145528151733s; --delay:-2.660409647183103s;"></div><div class="bubble" style="--size:2.9210803875086766rem; --distance:8.614251511559932rem; --position:85.11624368003845%; --time:2.7901010697979753s; --delay:-2.992117116600603s;"></div><div class="bubble" style="--size:5.21218292097785rem; --distance:6.690757175096992rem; --position:33.328622918428024%; --time:3.561173605567337s; --delay:-2.01878609927434s;"></div><div class="bubble" style="--size:5.394352012418913rem; --distance:8.794978815553073rem; --position:42.36247808122175%; --time:3.08983810958631s; --delay:-3.552139077257044s;"></div><div class="bubble" style="--size:4.471071161253791rem; --distance:7.170368705738145rem; --position:17.473632870388375%; --time:2.605540084799413s; --delay:-3.4228002576323147s;"></div><div class="bubble" style="--size:4.712247531926911rem; --distance:8.169137271761883rem; --position:16.044853949430077%; --time:3.4269778845424814s; --delay:-3.56110245134695s;"></div><div class="bubble" style="--size:5.025266500021116rem; --distance:9.009577644662713rem; --position:-1.4463706038458857%; --time:3.1741450713738755s; --delay:-2.533073866932202s;"></div><div class="bubble" style="--size:3.366667518440953rem; --distance:6.259105689543532rem; --position:21.791286743542624%; --time:3.84141749655629s; --delay:-3.6819601083416513s;"></div><div class="bubble" style="--size:3.4916526741493215rem; --distance:6.382972510063152rem; --position:62.50374961710024%; --time:2.5830056211150616s; --delay:-3.206999374527916s;"></div><div class="bubble" style="--size:2.1818222315307843rem; --distance:6.4932444361990305rem; --position:80.44063217850476%; --time:3.5006559130987696s; --delay:-3.5586618792758493s;"></div><div class="bubble" style="--size:3.8904016007077384rem; --distance:9.625145121450783rem; --position:29.869659339615225%; --time:3.3642707090071653s; --delay:-3.2367425875679956s;"></div><div class="bubble" style="--size:2.4445901747806964rem; --distance:9.97480081832957rem; --position:48.963436905978114%; --time:3.5158007759048164s; --delay:-2.0280308090348345s;"></div><div class="bubble" style="--size:5.78942928292336rem; --distance:7.642578408478374rem; --position:79.52959905542836%; --time:2.2043413442979456s; --delay:-2.342540015724345s;"></div><div class="bubble" style="--size:2.891734139860727rem; --distance:6.371701249878487rem; --position:85.75399149787656%; --time:2.604211458626319s; --delay:-3.88165078938981s;"></div><div class="bubble" style="--size:4.502790983088034rem; --distance:6.578880052956332rem; --position:78.89539958597852%; --time:2.9053746665018476s; --delay:-3.3853023066686463s;"></div><div class="bubble" style="--size:5.875939707179229rem; --distance:6.4656241063638795rem; --position:-2.7192537204324374%; --time:2.131252058136974s; --delay:-2.0500903315091135s;"></div><div class="bubble" style="--size:2.8059635855125054rem; --distance:6.012935260647309rem; --position:54.01764273327205%; --time:2.7894515809847196s; --delay:-3.856782915065119s;"></div><div class="bubble" style="--size:3.046732325763575rem; --distance:9.713647967164622rem; --position:48.95934826859079%; --time:2.2677239649750653s; --delay:-2.531767632608095s;"></div><div class="bubble" style="--size:4.351104706849513rem; --distance:9.105011501934396rem; --position:-0.7027269606984472%; --time:3.736179845887774s; --delay:-2.9394509010185157s;"></div><div class="bubble" style="--size:5.626624252865638rem; --distance:8.839433740100095rem; --position:3.320885174623779%; --time:2.1472498665002715s; --delay:-3.1259576246197023s;"></div><div class="bubble" style="--size:5.763466093882639rem; --distance:6.099047851903302rem; --position:37.73332648783827%; --time:2.230864637217502s; --delay:-2.022410985202986s;"></div><div class="bubble" style="--size:5.9553884909818855rem; --distance:6.195019698701944rem; --position:83.37988211948786%; --time:2.7822338696143736s; --delay:-2.7696387274656398s;"></div><div class="bubble" style="--size:2.991358864716627rem; --distance:8.217137724309017rem; --position:48.07223873164423%; --time:3.687834306083051s; --delay:-2.6156301323978237s;"></div><div class="bubble" style="--size:2.4104240173631952rem; --distance:6.142140085928424rem; --position:3.148785914855406%; --time:3.4930273638664744s; --delay:-2.588554835619879s;"></div><div class="bubble" style="--size:4.317406356555649rem; --distance:9.599914657656395rem; --position:84.48545930445825%; --time:3.552412495546945s; --delay:-3.0803777247107123s;"></div><div class="bubble" style="--size:2.484534896896381rem; --distance:6.060021680986212rem; --position:76.79648159022696%; --time:2.7134883169508908s; --delay:-2.9783195482693707s;"></div><div class="bubble" style="--size:2.9801655277923906rem; --distance:6.613394448092549rem; --position:84.42637404803446%; --time:3.694732233604648s; --delay:-3.942195877824764s;"></div><div class="bubble" style="--size:2.452445142916524rem; --distance:6.707173245370604rem; --position:-4.188262132676728%; --time:3.80682892716118s; --delay:-3.033342907893877s;"></div><div class="bubble" style="--size:5.461923492048783rem; --distance:6.036358050122983rem; --position:85.82607453235043%; --time:2.1169166264744734s; --delay:-3.996656449531758s;"></div></div><div class="content"><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Copyright © 2024 凯瑟兰森. All rights reserved.<p><a target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><div class="aplayer" data-id="2101454162" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>